<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Draw & Play Adventure</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(to bottom right, #e0f7fa, #ffe0b2);
      margin: 0;
      padding: 0;
      overflow: hidden;
      text-align: center;
    }
    h1 {
      padding: 10px;
      color: #ff7043;
    }
    #video, #canvas, #drawingBoard {
      display: block;
      margin: 10px auto;
      border: 4px dashed #ffca28;
      border-radius: 15px;
    }
    #controls {
      margin: 10px;
    }
    button {
      padding: 12px 20px;
      font-size: 16px;
      background-color: #4dd0e1;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #26c6da;
    }
    #characters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    .character {
      width: 100px;
      height: 100px;
      background-repeat: no-repeat;
      background-size: contain;
      position: absolute;
      animation: float 5s infinite ease-in-out;
    }
    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-20px) translateX(20px); }
      100% { transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h1>üé® Draw & Play Adventure</h1>
  <video id="video" width="320" height="240" autoplay playsinline muted></video>
  <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
  <div id="controls">
    <button onclick="captureDrawing()">üì∏ Capture Drawing</button>
    <button onclick="toggleSketchpad()">‚úèÔ∏è Use Sketchpad</button>
  </div>
  <canvas id="drawingBoard" width="320" height="240" style="display:none;"></canvas>
  <div id="characters"></div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const drawingBoard = document.getElementById('drawingBoard');
    const ctx = canvas.getContext('2d');
    const drawCtx = drawingBoard.getContext('2d');
    const charactersContainer = document.getElementById('characters');
    let isSketchpad = false;
    let isDrawing = false;

    async function setupCamera() {
      try {
        const constraints = {
          video: { facingMode: { ideal: "environment" } },
          audio: false
        };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        video.setAttribute('playsinline', true);
        video.setAttribute('autoplay', true);
        video.setAttribute('muted', true);
        video.play();
      } catch (err) {
        console.warn("Back camera unavailable, using default.", err);
        const fallbackStream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = fallbackStream;
      }
    }

    function captureDrawing() {
      if (isSketchpad) {
        const imageData = drawingBoard.toDataURL('image/png');
        createCharacter(imageData);
        clearCanvas(drawCtx);
      } else {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL('image/png');
        createCharacter(imageData);
      }
    }

    function toggleSketchpad() {
      isSketchpad = !isSketchpad;
      video.style.display = isSketchpad ? 'none' : 'block';
      drawingBoard.style.display = isSketchpad ? 'block' : 'none';
    }

    function createCharacter(imageData) {
      const name = prompt("Name your character:");
      if (!name) return;
      const character = document.createElement('div');
      character.className = 'character';
      character.style.backgroundImage = `url(${imageData})`;
      character.style.left = `${Math.random() * (window.innerWidth - 100)}px`;
      character.style.top = `${Math.random() * (window.innerHeight - 150)}px`;
      charactersContainer.appendChild(character);

      const msg = new SpeechSynthesisUtterance(`You just scanned ${name}! Let's go on an adventure!`);
      window.speechSynthesis.speak(msg);
    }

    function clearCanvas(context) {
      context.clearRect(0, 0, drawingBoard.width, drawingBoard.height);
    }

    drawingBoard.addEventListener('mousedown', () => isDrawing = true);
    drawingBoard.addEventListener('mouseup', () => isDrawing = false);
    drawingBoard.addEventListener('mouseout', () => isDrawing = false);
    drawingBoard.addEventListener('mousemove', draw);

    function draw(e) {
      if (!isDrawing) return;
      const rect = drawingBoard.getBoundingClientRect();
      drawCtx.fillStyle = '#000';
      drawCtx.beginPath();
      drawCtx.arc(e.clientX - rect.left, e.clientY - rect.top, 4, 0, Math.PI * 2);
      drawCtx.fill();
    }

    setupCamera();
  </script>
</body>
</html>
